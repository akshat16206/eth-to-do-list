<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Todo List DApp</title>

    <!-- Custom CSS -->
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(to bottom, #fff, #e6e6e6);
        min-height: 100vh;
      }
      
      .navbar {
        background-color: #333;
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .navbar-brand {
        font-size: 20px;
        font-weight: 500;
        color: white;
        text-decoration: none;
      }
      
      .account-address {
        font-size: 14px;
        opacity: 0.8;
      }
      
      .container {
        max-width: 600px;
        margin: 40px auto;
        padding: 0 20px;
      }
      
      #loader {
        text-align: center;
        padding: 50px 0;
      }
      
      .error-message {
        color: #d9534f;
        padding: 10px;
        margin: 20px 0;
        background-color: #f8d7da;
        border-radius: 4px;
      }
      
      .task-form {
        margin-bottom: 30px;
      }
      
      .task-input {
        width: 100%;
        padding: 12px 15px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }
      
      .task-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      
      .task-item {
        display: flex;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #eee;
      }
      
      .task-checkbox {
        margin-right: 15px;
        width: 20px;
        height: 20px;
      }
      
      .task-content {
        font-size: 16px;
      }
      
      .completed .task-content {
        color: #888;
        text-decoration: line-through;
      }
      
      .taskTemplate {
        display: none;
      }

      #debug-info {
        background-color: #f0f0f0;
        border: 1px solid #ddd;
        padding: 10px;
        margin-top: 20px;
        font-family: monospace;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <a class="navbar-brand">ADITI AGRAWAL | AKSHAT GUPTA | Todo List</a>
      <div class="account-address">
        <span id="account"></span>
      </div>
    </nav>
    
    <div class="container">
      <div id="loader">
        <p>Loading...</p>
      </div>

      <div id="error-message" class="error-message"></div>
      
      <div id="content">
        <form onSubmit="App.createTask(); return false;" class="task-form">
          <input id="newTask" type="text" class="task-input" placeholder="Add task..." required>
        </form>
        
        <h4>Tasks</h4>
        <ul id="taskList" class="task-list">
          <li class="taskTemplate task-item">
            <input type="checkbox" class="task-checkbox">
            <span class="task-content">Task content goes here...</span>
          </li>
        </ul>
        
        <h4>Completed</h4>
        <ul id="completedTaskList" class="task-list">
          <!-- Completed tasks will be added here -->
        </ul>

        <div id="debug-info">
          <h4>Debug Information</h4>
          <div id="debug-output"></div>
        </div>
      </div>
    </div>

    <!-- jQuery (Load first) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Web3.js -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    
    <!-- Load TruffleContract directly from unpkg (more reliable) -->
    <script src="https://unpkg.com/@truffle/contract@4.3.19/dist/truffle-contract.js"></script>

    <script>
      // Create a separate helper for debug output
      const Debug = {
        log: function(message) {
          console.log(message);
          const debugOutput = document.getElementById('debug-output');
          if (debugOutput) {
            const entry = document.createElement('div');
            entry.textContent = message;
            debugOutput.appendChild(entry);
          }
        },
        error: function(message) {
          console.error(message);
          const debugOutput = document.getElementById('debug-output');
          if (debugOutput) {
            const entry = document.createElement('div');
            entry.textContent = "ERROR: " + message;
            entry.style.color = 'red';
            debugOutput.appendChild(entry);
          }
        }
      };

      // Add a global error handler to catch script loading issues
      window.addEventListener('error', function(event) {
        Debug.error(`Script error in ${event.filename}: ${event.message}`);
        document.getElementById('error-message').textContent = 
          `A script error occurred: ${event.message}. Check the debug area for more details.`;
        document.getElementById('error-message').style.display = 'block';
      }, true);

      // Check if TruffleContract is loaded when the page is ready
      $(document).ready(function() {
        Debug.log("Document ready");
        
        // Check Web3 availability
        if (typeof Web3 !== 'undefined') {
          Debug.log("Web3 is available");
        } else {
          Debug.error("Web3 is NOT available");
        }
        
        // Check TruffleContract availability
        if (typeof TruffleContract !== 'undefined') {
          Debug.log("TruffleContract is available");
          window.TruffleContract = TruffleContract;
        } else {
          Debug.error("TruffleContract is NOT available");
        }

        // Start the application
        setTimeout(function() {
          App.load();
        }, 1000); // Give a bit more time for everything to load
      });
    </script>

    <!-- App.js -->
    <script src="app.js"></script>
  </body>
</html>